local function createBillboard(object, name, color)
    if espFolder:FindFirstChild(name .. "_" .. object:GetDebugId()) then return end
    local adornee = object:IsA("Model") and (object.PrimaryPart or object:FindFirstChild("HumanoidRootPart")) or object
    if not adornee or not adornee:IsA("BasePart") then return end  -- Ensure adornee is a BasePart

    local highlight = Instance.new("Highlight")
    highlight.Name = name .. "_" .. object:GetDebugId()
    highlight.Adornee = adornee
    highlight.FillColor = color
    highlight.FillTransparency = 0.4
    highlight.OutlineColor = Color3.new(0, 0, 0)
    highlight.OutlineTransparency = 0.2
    highlight.Parent = espFolder

    local billboard = Instance.new("BillboardGui", highlight)
    billboard.Name = "DistanceLabel"
    billboard.Size = UDim2.new(0, 100, 0, 40)
    billboard.AlwaysOnTop = true
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.Adornee = adornee

    local label = Instance.new("TextLabel", billboard)
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.new(1, 1, 1)
    label.TextStrokeTransparency = 0
    label.TextScaled = true
    label.Font = Enum.Font.SourceSansBold
    label.Text = name

    RunService.RenderStepped:Connect(function()
        if Players.LocalPlayer.Character and Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and adornee then
            local position = adornee.Position  -- Now we can safely access Position
            local dist = math.floor((position - Players.LocalPlayer.Character.HumanoidRootPart.Position).Magnitude)
            label.Text = name .. " [" .. dist .. "m]"
        end
    end)
end
